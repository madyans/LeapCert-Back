name: Notificar no Discord - Back-End

on:
  push:
    branches: [ main ]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Enviar notifica√ß√£o para o Discord (Back-End)
        run: |
          COMMIT_URL="${{ github.server_url }}/${{ github.repository }}/commit/${{ github.sha }}"
          COMMIT_MSG="${{ github.event.head_commit.message }}"
          DATA_HORA=$(TZ=America/Sao_Paulo date "+%a %d %b %Y %T %Z")

          curl -H "Content-Type: application/json" \
          -X POST \
          -d "{
            \"embeds\": [{
              \"title\": \"üõ†Ô∏è Atualiza√ß√£o no Back-End\",
              \"description\": \"**${{ github.actor }}** realizou um novo commit no reposit√≥rio **${{ github.repository }}**.\n\nüí¨ **Mensagem do commit:**\n\`\`\`${COMMIT_MSG}\`\`\`\",
              \"color\": 16753920,
              \"fields\": [
                {
                  \"name\": \"üîó Commit\",
                  \"value\": \"[Ver commit](${COMMIT_URL})\"
                },
                {
                  \"name\": \"üì¶ Branch\",
                  \"value\": \"${{ github.ref_name }}\",
                  \"inline\": true
                },
                {
                  \"name\": \"üïí Hora\",
                  \"value\": \"${DATA_HORA}\",
                  \"inline\": true
                }
              ],
              \"footer\": {
                \"text\": \"Back-end atualizado com sucesso üöÄ\"
              }
            }]
          }" \
          ${{ secrets.DISCORD_WEBHOOK }}
