name: "Notificar no Discord - Back-End"

on:
  push:
    branches: [main]

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Verificar se o webhook est√° setado
        run: |
          if [ -z "${{ secrets.DISCORD_WEBHOOK }}" ]; then
            echo "‚ö†Ô∏è DISCORD_WEBHOOK est√° vazio"
            exit 1
          else
            echo "‚úÖ DISCORD_WEBHOOK est√° configurado"
          fi

      - name: Enviar notifica√ß√£o para o Discord (Back-End)
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          COMMIT_URL: "${{ github.server_url }}/${{ github.repository }}/commit/${{ github.sha }}"
          COMMIT_MSG: "${{ github.event.head_commit.message }}"
          COMMIT_AUTHOR: "${{ github.actor }}"
          COMMIT_BRANCH: "${{ github.ref_name }}"
        run: |
          DATA_HORA=$(TZ=America/Sao_Paulo date "+%a %d %b %Y %T %Z")
          curl -H "Content-Type: application/json" \
            -X POST \
            -d "{
              \"embeds\": [{
                \"title\": \"üõ†Ô∏è Atualiza√ß√£o no Back-End\",
                \"description\": \"**${COMMIT_AUTHOR}** enviou um novo commit para o reposit√≥rio **${GITHUB_REPOSITORY}**.\n\nüí¨ **Mensagem do commit:**\n${COMMIT_MSG}\",
                \"color\": 15158332,
                \"fields\": [
                  {
                    \"name\": \"üîó Commit\",
                    \"value\": \"[Ver commit](${COMMIT_URL})\"
                  },
                  {
                    \"name\": \"üì¶ Branch\",
                    \"value\": \"${COMMIT_BRANCH}\",
                    \"inline\": true
                  },
                  {
                    \"name\": \"üïí Hora\",
                    \"value\": \"${DATA_HORA}\",
                    \"inline\": true
                  }
                ],
                \"footer\": {
                  \"text\": \"Back-end turbinado com novidades ‚öôÔ∏èüöÄ\"
                }
              }]
            }" \
            "$DISCORD_WEBHOOK"
